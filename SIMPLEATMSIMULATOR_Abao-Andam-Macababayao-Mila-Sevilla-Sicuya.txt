#include <stdio.h>
#include <time.h>

int main() {
    float balance = 0.00, amount;
    int choice;
    char again;

    FILE *logFile;
    FILE *receiptFile;

    time_t now;
    char *dateTime;

    do {
        printf("\n<<< SIMPLE ATM SIMULATOR >>>\n");
        printf("[1] Check Balance\n");
        printf("[2] Deposit\n");
        printf("[3] Withdraw\n");
        printf("[4] Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

        if (choice == 1) {
            printf("\nYour current balance is: ₱%.2f\n", balance);
        }
        else if (choice == 2) {
            printf("Enter amount to deposit: ₱");
            scanf("%f", &amount);

            if (amount <= 0) {
                printf("Invalid amount.\n");
            } else {
                balance += amount;

                time(&now);
                dateTime = ctime(&now);

                logFile = fopen("transactions.txt", "a");
                fprintf(logFile, "DEPOSIT | ₱%.2f | Balance: ₱%.2f | %s",
                        amount, balance, dateTime);
                fclose(logFile);

                receiptFile = fopen("receipt.txt", "w");
                fprintf(receiptFile, "----- ATM RECEIPT -----\n");
                fprintf(receiptFile, "Transaction: DEPOSIT\n");
                fprintf(receiptFile, "Amount: ₱%.2f\n", amount);
                fprintf(receiptFile, "Balance: ₱%.2f\n", balance);
                fprintf(receiptFile, "Date & Time: %s", dateTime);
                fprintf(receiptFile, "-----------------------\n");
                fclose(receiptFile);

                printf("\n----- ATM RECEIPT -----\n");
                printf("Transaction: DEPOSIT\n");
                printf("Amount: ₱%.2f\n", amount);
                printf("Balance: ₱%.2f\n", balance);
                printf("Date & Time: %s", dateTime);
                printf("-----------------------\n");
            }
        }
        else if (choice == 3) {
            printf("Enter amount to withdraw: ₱");
            scanf("%f", &amount);

            if (amount <= 0) {
                printf("Invalid amount.\n");
            }
            else if (amount > balance) {
                printf("Insufficient balance.\n");
            }
            else {
                balance -= amount;

                time(&now);
                dateTime = ctime(&now);

                logFile = fopen("transactions.txt", "a");
                fprintf(logFile, "WITHDRAW | ₱%.2f | Balance: ₱%.2f | %s",
                        amount, balance, dateTime);
                fclose(logFile);

                receiptFile = fopen("receipt.txt", "w");
                fprintf(receiptFile, "----- ATM RECEIPT -----\n");
                fprintf(receiptFile, "Transaction: WITHDRAW\n");
                fprintf(receiptFile, "Amount: ₱%.2f\n", amount);
                fprintf(receiptFile, "Balance: ₱%.2f\n", balance);
                fprintf(receiptFile, "Date & Time: %s", dateTime);
                fprintf(receiptFile, "-----------------------\n");
                fclose(receiptFile);

                printf("\n----- ATM RECEIPT -----\n");
                printf("Transaction: WITHDRAW\n");
                printf("Amount: ₱%.2f\n", amount);
                printf("Balance: ₱%.2f\n", balance);
                printf("Date & Time: %s", dateTime);
                printf("-----------------------\n");
            }
        }
        else if (choice == 4) {
            printf("Exiting program...\n");
        }
        else {
            printf("Invalid choice.\n");
        }

        if (choice != 4) {
            printf("\nAnother transaction? [Y/N]: ");
            scanf(" %c", &again);
        } else {
            again = 'N';
        }

    } while (again == 'Y' || again == 'y');

    printf("\nThank you for using the ATM.\n");
    return 0;
}